{
	"info": {
		"_postman_id": "tspark-full-api-collection-2024",
		"name": "TSPark - Complete API (Phase 2 & 3)",
		"description": "Complete API endpoints for TSPark fitness platform.\n\n## Phase 2 - Core Authentication ‚úÖ\n- User Registration\n- User Login (JWT token generation)\n- Get Current User Profile (protected route)\n- Error scenarios for testing\n\n## Phase 3 - User Management ‚úÖ\n- List All Users (Super Admin only)\n- Get User Profile (own or Super Admin)\n- Update User Profile (own or Super Admin)\n- Change Password (own only)\n- Delete User (Super Admin only)\n- Get User Statistics (own or Super Admin)\n\n## How to Use:\n1. Start your server: `npm run dev`\n2. Run \"Register User\" to create an account\n3. Run \"Login\" to get a JWT token (auto-saved)\n4. Run user management endpoints with saved token\n5. Try error scenarios to test authorization\n\n## Environment Setup:\nBase URL: http://localhost:3000/api\n\nCreated: 2024-01-19\nUpdated: 2024-01-19 (Phase 3 added)\nStatus: ‚úÖ Complete",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Phase 2 - Authentication",
			"item": [
				{
					"name": "Register User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201 Created\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"pm.test(\"Response has success field\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"});",
									"",
									"pm.test(\"Response contains user data\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('user');",
									"    pm.expect(jsonData.data.user).to.have.property('id');",
									"});",
									"",
									"pm.test(\"Password is not returned\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data.user).to.not.have.property('password');",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"if (jsonData.data && jsonData.data.user) {",
									"    pm.collectionVariables.set(\"user_id\", jsonData.data.user.id);",
									"    pm.collectionVariables.set(\"user_email\", jsonData.data.user.email);",
									"    console.log(\"‚úÖ User registered:\", jsonData.data.user.email);",
									"    console.log(\"üíæ User ID saved:\", jsonData.data.user.id);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"john.doe@tspark.com\",\n  \"password\": \"SecurePass123\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\",\n  \"role\": \"client\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"register"
							]
						},
						"description": "**Register a new user account**\n\nRequest Body:\n- `email` (required): User's email\n- `password` (required): Min 8 characters\n- `firstName` (required): First name\n- `lastName` (required): Last name\n- `role` (optional): client/gym_owner/super_admin"
					},
					"response": []
				},
				{
					"name": "Register Super Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 201 Created\", function () {",
									"    pm.response.to.have.status(201);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"if (jsonData.data && jsonData.data.user) {",
									"    pm.collectionVariables.set(\"admin_email\", jsonData.data.user.email);",
									"    console.log(\"‚úÖ Super Admin registered:\", jsonData.data.user.email);",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"admin@tspark.com\",\n  \"password\": \"AdminSecure123\",\n  \"firstName\": \"Admin\",\n  \"lastName\": \"User\",\n  \"role\": \"super_admin\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"register"
							]
						},
						"description": "**Register a Super Admin account**\n\nUsed for testing admin-only endpoints."
					},
					"response": []
				},
				{
					"name": "Login",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains token\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('token');",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"if (jsonData.data && jsonData.data.token) {",
									"    pm.collectionVariables.set(\"auth_token\", jsonData.data.token);",
									"    console.log(\"‚úÖ Login successful! Token saved.\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"john.doe@tspark.com\",\n  \"password\": \"SecurePass123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						},
						"description": "**Authenticate and get JWT token**\n\nToken expires in 24 hours."
					},
					"response": []
				},
				{
					"name": "Login as Super Admin",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"if (jsonData.data && jsonData.data.token) {",
									"    pm.collectionVariables.set(\"admin_token\", jsonData.data.token);",
									"    console.log(\"‚úÖ Admin login successful! Token saved.\");",
									"}"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"admin@tspark.com\",\n  \"password\": \"AdminSecure123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						},
						"description": "**Login as Super Admin**\n\nSaves admin token to test admin-only endpoints."
					},
					"response": []
				},
				{
					"name": "Get Current User",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains user\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('user');",
									"});",
									"",
									"console.log(\"‚úÖ Current user retrieved successfully\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/auth/me",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"me"
							]
						},
						"description": "**Get current authenticated user profile**\n\nProtected route - requires JWT token."
					},
					"response": []
				}
			],
			"description": "Phase 2: Core authentication endpoints"
		},
		{
			"name": "Phase 3 - User Management",
			"item": [
				{
					"name": "List All Users (Admin Only)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains users array\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('users');",
									"    pm.expect(jsonData.data.users).to.be.an('array');",
									"});",
									"",
									"pm.test(\"No passwords in response\", function () {",
									"    var jsonData = pm.response.json();",
									"    jsonData.data.users.forEach(user => {",
									"        pm.expect(user).to.not.have.property('password');",
									"    });",
									"});",
									"",
									"console.log(\"‚úÖ Users list retrieved:\", pm.response.json().data.users.length, \"users\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users"
							]
						},
						"description": "**List all users (Super Admin only)**\n\nReturns all users without passwords.\n\n**Authorization:**\n- Requires Super Admin role\n- Returns 403 if not Super Admin"
					},
					"response": []
				},
				{
					"name": "Get User by ID (Own Profile)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains user\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('user');",
									"});",
									"",
									"pm.test(\"Password not returned\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data.user).to.not.have.property('password');",
									"});",
									"",
									"console.log(\"‚úÖ User profile retrieved\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users/{{user_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"{{user_id}}"
							]
						},
						"description": "**Get user profile by ID**\n\n**Authorization:**\n- Users can view their own profile\n- Super Admins can view any profile\n- Returns 403 if trying to view other user's profile"
					},
					"response": []
				},
				{
					"name": "Update User Profile (Own)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"User updated successfully\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data.user.firstName).to.eql('Jonathan');",
									"});",
									"",
									"console.log(\"‚úÖ Profile updated successfully\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Jonathan\",\n  \"lastName\": \"Doe\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/users/{{user_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"{{user_id}}"
							]
						},
						"description": "**Update user profile**\n\n**Fields:**\n- firstName (optional)\n- lastName (optional)\n- email (optional) - must be unique\n\n**Authorization:**\n- Users can update their own profile\n- Super Admins can update any profile"
					},
					"response": []
				},
				{
					"name": "Update User Email",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Email updated successfully\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data.user.email).to.eql('john.updated@tspark.com');",
									"});",
									"",
									"var jsonData = pm.response.json();",
									"if (jsonData.data && jsonData.data.user) {",
									"    pm.collectionVariables.set(\"user_email\", jsonData.data.user.email);",
									"}",
									"",
									"console.log(\"‚úÖ Email updated successfully\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"john.updated@tspark.com\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/users/{{user_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"{{user_id}}"
							]
						},
						"description": "**Update user email**\n\n**Validation:**\n- Email must be valid format\n- Email must be unique (409 if duplicate)"
					},
					"response": []
				},
				{
					"name": "Change Password",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Password changed successfully\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"    pm.expect(jsonData.message).to.include('Password changed');",
									"});",
									"",
									"console.log(\"‚úÖ Password changed successfully\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"currentPassword\": \"SecurePass123\",\n  \"newPassword\": \"NewSecurePass123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/users/{{user_id}}/password",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"{{user_id}}",
								"password"
							]
						},
						"description": "**Change user password**\n\n**Requirements:**\n- Must provide current password\n- New password must be 8+ characters\n- Can only change own password (not even admin)\n\n**Security:**\n- Verifies current password before changing\n- New password is hashed with bcrypt"
					},
					"response": []
				},
				{
					"name": "Get User Statistics",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"Response contains stats\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.data).to.have.property('totalPoints');",
									"    pm.expect(jsonData.data).to.have.property('memberSince');",
									"});",
									"",
									"console.log(\"‚úÖ User stats:\", JSON.stringify(pm.response.json().data, null, 2));"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users/{{user_id}}/stats",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"{{user_id}}",
								"stats"
							]
						},
						"description": "**Get user statistics**\n\nReturns:\n- totalPoints: User's total points\n- memberSince: Account creation date\n\n**Authorization:**\n- Users can view their own stats\n- Super Admins can view any user's stats"
					},
					"response": []
				},
				{
					"name": "Delete User (Admin Only)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 200 OK\", function () {",
									"    pm.response.to.have.status(200);",
									"});",
									"",
									"pm.test(\"User deleted successfully\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(true);",
									"    pm.expect(jsonData.message).to.include('deleted');",
									"});",
									"",
									"console.log(\"‚úÖ User deleted (soft delete - status set to SUSPENDED)\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{admin_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users/{{user_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"{{user_id}}"
							]
						},
						"description": "**Delete user (Super Admin only)**\n\n**Implementation:**\n- Soft delete: sets status to SUSPENDED\n- User cannot login after deletion\n- Data preserved for audit trail\n\n**Authorization:**\n- Only Super Admin can delete users"
					},
					"response": []
				}
			],
			"description": "Phase 3: User management and profile operations"
		},
		{
			"name": "Error Scenarios - Authentication",
			"item": [
				{
					"name": "Register - Duplicate Email (409)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 409 Conflict\", function () {",
									"    pm.response.to.have.status(409);",
									"});",
									"",
									"pm.test(\"Error message about duplicate email\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(false);",
									"    pm.expect(jsonData.message).to.include('already exists');",
									"});",
									"",
									"console.log(\"‚úÖ Duplicate email correctly rejected\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"john.doe@tspark.com\",\n  \"password\": \"SecurePass123\",\n  \"firstName\": \"John\",\n  \"lastName\": \"Doe\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/register",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"register"
							]
						},
						"description": "Test duplicate email registration"
					},
					"response": []
				},
				{
					"name": "Login - Wrong Password (401)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 401 Unauthorized\", function () {",
									"    pm.response.to.have.status(401);",
									"});",
									"",
									"console.log(\"‚úÖ Wrong password rejected\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"john.doe@tspark.com\",\n  \"password\": \"WrongPassword123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/auth/login",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"login"
							]
						}
					},
					"response": []
				},
				{
					"name": "Protected Route - No Token (401)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 401 Unauthorized\", function () {",
									"    pm.response.to.have.status(401);",
									"});",
									"",
									"console.log(\"‚úÖ Missing token rejected\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/auth/me",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"auth",
								"me"
							]
						}
					},
					"response": []
				}
			]
		},
		{
			"name": "Error Scenarios - User Management",
			"item": [
				{
					"name": "List Users - Not Admin (403)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 403 Forbidden\", function () {",
									"    pm.response.to.have.status(403);",
									"});",
									"",
									"pm.test(\"Insufficient permissions message\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.success).to.eql(false);",
									"});",
									"",
									"console.log(\"‚úÖ Non-admin correctly blocked from listing users\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users"
							]
						},
						"description": "**Test non-admin trying to list all users**\n\nExpected: 403 Forbidden"
					},
					"response": []
				},
				{
					"name": "Update Other User - Forbidden (403)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 403 Forbidden\", function () {",
									"    pm.response.to.have.status(403);",
									"});",
									"",
									"console.log(\"‚úÖ User correctly blocked from updating other user's profile\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"firstName\": \"Hacker\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/users/00000000-0000-0000-0000-000000000000",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"00000000-0000-0000-0000-000000000000"
							]
						},
						"description": "**Test user trying to update another user's profile**\n\nExpected: 403 Forbidden"
					},
					"response": []
				},
				{
					"name": "Change Password - Wrong Current Password (400)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 400 Bad Request\", function () {",
									"    pm.response.to.have.status(400);",
									"});",
									"",
									"pm.test(\"Error message about wrong password\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('Current password is incorrect');",
									"});",
									"",
									"console.log(\"‚úÖ Wrong current password rejected\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"currentPassword\": \"WrongPassword\",\n  \"newPassword\": \"NewPassword123\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/users/{{user_id}}/password",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"{{user_id}}",
								"password"
							]
						},
						"description": "**Test password change with wrong current password**\n\nExpected: 400 Bad Request"
					},
					"response": []
				},
				{
					"name": "Update Email - Duplicate (409)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 409 Conflict\", function () {",
									"    pm.response.to.have.status(409);",
									"});",
									"",
									"pm.test(\"Duplicate email error\", function () {",
									"    var jsonData = pm.response.json();",
									"    pm.expect(jsonData.message).to.include('already in use');",
									"});",
									"",
									"console.log(\"‚úÖ Duplicate email correctly rejected\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "PATCH",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n  \"email\": \"admin@tspark.com\"\n}"
						},
						"url": {
							"raw": "{{base_url}}/users/{{user_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"{{user_id}}"
							]
						},
						"description": "**Test updating email to one that already exists**\n\nExpected: 409 Conflict"
					},
					"response": []
				},
				{
					"name": "Delete User - Not Admin (403)",
					"event": [
						{
							"listen": "test",
							"script": {
								"exec": [
									"pm.test(\"Status code is 403 Forbidden\", function () {",
									"    pm.response.to.have.status(403);",
									"});",
									"",
									"console.log(\"‚úÖ Non-admin correctly blocked from deleting users\");"
								],
								"type": "text/javascript"
							}
						}
					],
					"request": {
						"auth": {
							"type": "bearer",
							"bearer": [
								{
									"key": "token",
									"value": "{{auth_token}}",
									"type": "string"
								}
							]
						},
						"method": "DELETE",
						"header": [],
						"url": {
							"raw": "{{base_url}}/users/{{user_id}}",
							"host": [
								"{{base_url}}"
							],
							"path": [
								"users",
								"{{user_id}}"
							]
						},
						"description": "**Test non-admin trying to delete a user**\n\nExpected: 403 Forbidden"
					},
					"response": []
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					"console.log('üöÄ Request:', pm.request.method, pm.request.url.toString());",
					"",
					"const token = pm.collectionVariables.get('auth_token');",
					"const adminToken = pm.collectionVariables.get('admin_token');",
					"if (token || adminToken) {",
					"    console.log('üîë Using authentication token');",
					"}"
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"console.log('üìä Status:', pm.response.code, pm.response.status);",
					"console.log('‚è±Ô∏è  Time:', pm.response.responseTime + 'ms');",
					"",
					"try {",
					"    const jsonData = pm.response.json();",
					"    console.log('üìÑ Response:', JSON.stringify(jsonData, null, 2));",
					"} catch(e) {",
					"    console.log('üìÑ Non-JSON response');",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:3000/api",
			"type": "string"
		},
		{
			"key": "auth_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "admin_token",
			"value": "",
			"type": "string"
		},
		{
			"key": "user_id",
			"value": "",
			"type": "string"
		},
		{
			"key": "user_email",
			"value": "",
			"type": "string"
		},
		{
			"key": "admin_email",
			"value": "",
			"type": "string"
		}
	]
}
